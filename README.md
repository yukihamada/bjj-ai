# BJJ-AI

BJJ-AIは、ブラジリアン柔術のトレーニングを支援するためのAI得点判定システムです。このシステムは、Webブラウザ上で動作し、Cloudflare Workersを使用して実装されています。柔術の試合をリアルタイムで分析し、得点を判定することで、トレーニングの質を向上させることができます。

サービスは [bjj-connect.org](https://bjj-connect.org) で確認できます。以下の手順でアクセスしてください。

## 前提条件

- Node.js (バージョン14以上)
- npm (バージョン6以上)

## 使用方法

### Next.jsプロジェクトの起動方法

1. **依存関係のインストール**:
   プロジェクトのルートディレクトリで以下のコマンドを実行して、依存関係をインストールします。
   ```bash
   npm install
   ```

2. **開発サーバーの起動**:
   以下のコマンドを実行して、開発サーバーを起動します。
   ```bash
   npm run dev
   ```

3. **ブラウザで確認**:
   ブラウザで [http://localhost:3000](http://localhost:3000) にアクセスして、アプリケーションを確認します。

### 環境変数の設定

プロジェクトのルートディレクトリに`.env`ファイルを作成し、以下の環境変数を設定します。

```
NEXT_PUBLIC_API_URL=your_api_url
```

### 試合の開始と終了

1. **試合時間の選択**:
   試合開始前に、1分から10分の間で試合時間を選択します。

2. **試合開始**:
   「試合開始」ボタンを押すと、カウントダウンタイマーが表示され、キャプチャが開始されます。

3. **試合終了**:
   試合時間が終了するか、「試合終了」ボタンを押すと、キャプチャが停止します。

4. **試合停止**:
   「試合停止」ボタンを押すと、試合が途中で停止されます。

## システムの話

### システム概要

1. **画像キャプチャ**:
   - ブラウザで0.5秒ごとに画像をキャプチャします。
   - HTML5の`<video>`要素と`getUserMedia`を使用してカメラ映像を取得し、JavaScriptの`setInterval`を使って0.5秒ごとに画像をキャプチャし、配列に保存します。

2. **画像合成**:
   - 9枚の画像が揃ったら、1枚の連続画像として合成します。合成にはCanvas APIを使用し、合成した画像をBase64形式にエンコードします。

3. **画像送信**:
   - 合成された画像をCloudflare WorkersにPOSTリクエストで送信します。

4. **得点判定**:
   - Cloudflare Workers内で受信した画像をAIモデルに渡し、柔術の得点を判定します。AIモデルの推論には、適切なAPI（例：OpenAI API）を使用します。

5. **結果表示**:
   - サーバーから返された得点結果をブラウザで表示します。

### プロジェクトのファイル構成

#### プロジェクトのルートディレクトリ
- `README.md`: プロジェクトの概要とシステムの要件が記載されています。
- `next-env.d.ts`: TypeScriptの環境設定ファイルです。
- `next.config.js`: Next.jsの設定ファイルです。
- `package.json`: プロジェクトの依存関係とスクリプトが記載されています。
- `package-lock.json`: 依存関係の正確なバージョンが記載されています。
- `tsconfig.json`: TypeScriptのコンパイルオプションが記載されています。

#### `app` ディレクトリ
- `camera.js`: カメラ関連のJavaScriptコードが含まれています。
- `camera.tsx`: カメラ関連のTypeScriptコードが含まれています。
- `favicon.ico`: ブラウザのタブに表示されるアイコンファイルです。
- `globals.css`: グローバルなCSSスタイルが記載されています。
- `history.tsx`: 履歴関連のTypeScriptコードが含まれています。
- `layout.tsx`: レイアウト関連のTypeScriptコードが含まれています。
- `page.js`: ページ関連のJavaScriptコードが含まれています。
- `result.tsx`: 結果表示関連のTypeScriptコードが含まれています。
- `settings.tsx`: 設定関連のTypeScriptコードが含まれています。

#### `node_modules` ディレクトリ
- プロジェクトの依存関係がインストールされているディレクトリです。各パッケージの詳細は省略しますが、主要なパッケージには `react`, `next`, `typescript` などがあります。

## テストの実行方法

以下のコマンドを実行して、テストを実行します。
```bash
npm run test
```

## デプロイ方法

以下のコマンドを実行して、プロジェクトを本番環境にデプロイします。
```bash
npm run build
npm run start
```

## 貢献ガイドライン

1. フォークしてリポジトリをクローンします
2. 変更を加えるブランチを作成します
3. 変更を加える
4. プルリクエストを作成します
5. コントリビューションをレビューします
6. マージします